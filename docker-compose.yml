version: '3.8'

services:
  manager-agent:
    build: .
    ports:
      - "8000:8000"
    environment:
      # Ensure these environment variables are set correctly
      TECHNICAL_AGENT_URL: http://technical-agent:8000
      FUNDAMENTAL_AGENT_URL: http://fundamental-agent:8001
      DATABASE_AGENT_URL: http://database-agent:8003
      AUTO_LEARNING_AGENT_URL: http://learning-agent:8004
      EXECUTION_AGENT_URL: http://execution-agent:8006
      EXECUTION_API_KEY: your_secret_key
      DEFAULT_ACCOUNT_ID: 1
      RISK_PER_TRADE: 0.01
      STOP_LOSS_PERCENTAGE: 0.03
      MAX_POSITION_PERCENTAGE: 0.20
      ENABLE_TECHNICAL_STOP: "true"
      MAX_TOTAL_EXPOSURE: 0.50
      PER_REQUEST_RISK_BUDGET: 0.05
      MIN_POSITION_VALUE: 500.0
      TECHNICAL_AGENT_WEIGHT: 0.5
      FUNDAMENTAL_AGENT_WEIGHT: 0.5
      LEARNING_MODE: conservative
      WINDOW_SIZE: 50
      # DB Client specific (can be different)
      DB_CLIENT_TIMEOUT: 10
      DB_CLIENT_MAX_RETRIES: 3
      DB_CLIENT_BACKOFF_FACTOR: 0.5
      DB_CLIENT_FAILURE_THRESHOLD: 5
      DB_CLIENT_COOLDOWN_PERIOD: 30
      # Generic Agent Client
      AGENT_CLIENT_TIMEOUT: 10
      AGENT_CLIENT_MAX_RETRIES: 3
      AGENT_CLIENT_BACKOFF_FACTOR: 0.5
      AGENT_CLIENT_FAILURE_THRESHOLD: 5
      AGENT_CLIENT_COOLDOWN_PERIOD: 30
      ASSET_BIASES: "{}"
    volumes:
      - ./logs:/app/logs
      - ./config_data:/app/config_data
    depends_on:
      - technical-agent
      - fundamental-agent
      - database-agent
      - learning-agent

  technical-agent:
    build: ./Technical_Agent
    ports:
      - "8001:8000"
    environment:
      API_KEY: your_technical_api_key
    volumes:
      - ./Technical_Agent/app:/app/app

  fundamental-agent:
    build: ./Fundamental_Agent
    ports:
      - "8002:8001" # Host port was conflicting with technical-agent, changed to 8002
    environment:
      API_KEY: your_fundamental_api_key
    volumes:
      - ./Fundamental_Agent/app:/app/app

  database-agent:
    build: ./Database_Agent
    ports:
      - "8003:8000"
    environment:
      API_KEY: your_database_api_key
    volumes:
      - ./Database_Agent/app:/app/app
      - ./Database_Agent/example.db:/app/example.db

  learning-agent:
    build: ./Learning_Agent
    ports:
      - "8004:8000"
    environment:
      API_KEY: your_learning_api_key
    volumes:
      - ./Learning_Agent/learning_agent:/app/learning_agent
