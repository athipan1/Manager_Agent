services:
  manager-agent:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8000:80"
    environment:
      TECHNICAL_AGENT_URL: http://technical-agent:8002
      FUNDAMENTAL_AGENT_URL: http://fundamental-agent:8001
      SCANNER_AGENT_URL: http://scanner-agent:8000
      DATABASE_AGENT_URL: http://database-agent:8000
      DATABASE_AGENT_API_KEY: your_database_api_key
      AUTO_LEARNING_AGENT_URL: http://learning-agent:8004
      EXECUTION_AGENT_URL: http://execution-agent:8005
      EXECUTION_API_KEY: your_secret_key
      DEFAULT_ACCOUNT_ID: 1
      RISK_PER_TRADE: 0.01
      STOP_LOSS_PERCENTAGE: 0.03
      MAX_POSITION_PERCENTAGE: 0.20
      ENABLE_TECHNICAL_STOP: "true"
      MAX_TOTAL_EXPOSURE: 0.50
      PER_REQUEST_RISK_BUDGET: 0.05
      MIN_POSITION_VALUE: 500.0
      TECHNICAL_AGENT_WEIGHT: 0.5
      FUNDAMENTAL_AGENT_WEIGHT: 0.5
      LEARNING_MODE: conservative
      WINDOW_SIZE: 50
      DB_CLIENT_TIMEOUT: 10
      DB_CLIENT_MAX_RETRIES: 3
      DB_CLIENT_BACKOFF_FACTOR: 0.5
      DB_CLIENT_FAILURE_THRESHOLD: 5
      DB_CLIENT_COOLDOWN_PERIOD: 30
      AGENT_CLIENT_TIMEOUT: 10
      AGENT_CLIENT_MAX_RETRIES: 3
      AGENT_CLIENT_BACKOFF_FACTOR: 0.5
      AGENT_CLIENT_FAILURE_THRESHOLD: 5
      AGENT_CLIENT_COOLDOWN_PERIOD: 30
      ASSET_BIASES: "{}"
    depends_on:
      technical-agent:
        condition: service_healthy
      fundamental-agent:
        condition: service_healthy
      scanner-agent:
        condition: service_healthy
      database-agent:
        condition: service_healthy
      learning-agent:
        condition: service_healthy
      execution-agent:
        condition: service_healthy

  scanner-agent:
    build:
      context: ./Scanner_Agent
      dockerfile: Dockerfile
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      PYTHONPATH: /code

  technical-agent:
    build:
      context: ./Technical_Agent
      dockerfile: Dockerfile
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8002/health')"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      TECHNICAL_AGENT_API_KEY: your_technical_api_key
      PYTHONPATH: /app

  fundamental-agent:
    build:
      context: ./Fundamental_Agent
      dockerfile: Dockerfile
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8001/health')"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      FUNDAMENTAL_AGENT_API_KEY: your_fundamental_api_key
      PYTHONPATH: /app

  database-agent:
    build:
      context: ./Database_Agent
      dockerfile: Dockerfile
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      DATABASE_AGENT_API_KEY: your_database_api_key
      USE_SQLITE: "true"
    volumes:
      - ./data:/home/app/code/data

  learning-agent:
    build:
      context: ./Learning_Agent
      dockerfile: Dockerfile
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8004/health')"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      LEARNING_AGENT_API_KEY: your_learning_api_key
      DATABASE_AGENT_URL: http://database-agent:8000
      DATABASE_AGENT_API_KEY: your_database_api_key
      PYTHONPATH: /home/app/web

  execution-agent:
    build:
      context: ./execution-agent
      dockerfile: Dockerfile
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8005/health')"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      EXECUTION_AGENT_API_KEY: your_secret_key
      DATABASE_AGENT_URL: http://database-agent:8000
      DATABASE_AGENT_API_KEY: your_database_api_key
      BROKER_MODE: "SIMULATOR"
      PYTHONPATH: /home/appuser/src
